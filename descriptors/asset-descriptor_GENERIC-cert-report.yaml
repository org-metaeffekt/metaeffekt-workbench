inventories:
  - "inventory":
      folder: "${input.inventory.dir}"
      type: INPUT
  - merged-inventory:
      file: "${param.computed.inventory.dir}/${asset.name}-vulnerability-report-inventory.xlsx"
      type: COMPUTED
  - "cert-advisory-inventory":
      file: "${param.computed.inventory.dir}/${asset.name}-statistics-report-inventory.xlsx"
      type: COMPUTED

transformations:
  "merge-advisors":
    inputInventories:
      - "inventory"
    outputInventories:
      - "merged-inventory"
    params:
      input.inventory.dir: "${inventory.folder}"
      output.inventory.file: "${merged-inventory.file}"
      param.security.policy.file: "${security.policy.file}"
      param.security.policy.active.ids: "cert_extended_configuration"
    maven:
      pom: "${kontinuum.processors.dir}/util/util_merge-advisors.xml"
      workingDir: "."
      command: "generate-sources"

  "enrich-advisors":
    inputInventories:
      - "merged-inventory"
    outputInventories:
      - "cert-advisory-inventory"
    params:
      input.inventory.file: "${merged-inventory.file}"
      output.inventory.file: "${cert-advisory-inventory.file}"
      env.vulnerability.mirror.dir: "${env.vulnerability.mirror.dir}"
      param.report.period.since: "${report.period.since}"
      param.report.period.until: "${report.period.until}"
      param.security.policy.file: "${security.policy.file}"
      param.security.policy.active.ids: "cert_extended_configuration"
    maven:
      pom: "${kontinuum.processors.dir}/util/util_enrich-advisors.xml"
      workingDir: "."
      command: "generate-sources"

documents:
  "cert-report":
    type: PERIODIC_VULNERABILITY_REPORT
    language: "${document.language}"
    params:
      #parameters for generated parts
      securityPolicyFile: "${security.policy.file}"

      #parameters for generated properties
      vulnerability.report.properties.reference: "cert-advisory-inventory"
      vulnerability.summary.properties.reference: "cert-advisory-inventory"

      #parameters for report content references (match with inventoryRef)
      vulnerability.summary.part.content.reference: "cert-advisory-inventory"
      vulnerability.report.content.reference: "cert-advisory-inventory"
      vulnerability.statistics.report.content.reference: "cert-advisory-inventory"
      vulnerability.statistics.report.all.content.reference: "merged-inventory"

      #parameter for report content references (match with part name)
      vulnerability.statistics.part.name: "statistics-part"
      vulnerability.statistics.part.all.name: "statistics-part-all"
    parts:
      "summary-part":
        type: VULNERABILITY_SUMMARY_PART
        params:
          securityPolicyActiveIds: "cert_extended_configuration"
          filterAdvisorySummary: "true"
        inventories:
          - inventoryRef: "cert-advisory-inventory"
            assetName: "${asset.name}"
            assetVersion: "${asset.version}"

      "vulnerability-part":
        type: VULNERABILITY_REPORT
        params:
          securityPolicyActiveIds: "cert_extended_configuration"
          filterAdvisorySummary: "true"
        inventories:
          - inventoryRef: "cert-advisory-inventory"
            assetName: "${asset.name}"
            assetVersion: "${asset.version}"

      "statistics-part":
        type: VULNERABILITY_STATISTICS_REPORT
        params:
          securityPolicyActiveIds: "cert_configuration"
          filterAdvisorySummary: "true"
        inventories:
          - inventoryRef: "cert-advisory-inventory"
            assetName: "${asset.name}"
            assetVersion: "${asset.version}"

      "statistics-part-all":
        type: VULNERABILITY_STATISTICS_REPORT
        params:
          securityPolicyActiveIds: "cert_configuration"
        inventories:
          - inventoryRef: "merged-inventory"
            assetName: "${asset.name}"
            assetVersion: "${asset.version}"
